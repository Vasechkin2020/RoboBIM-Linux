–Ø –æ–±–Ω–æ–≤–ª—é —Ñ–∞–π–ª G-code (/control_code/my_custom_gcode.txt) –∏ –∫–æ–¥ –Ω–∞ C++ –¥–ª—è ROS1, —á—Ç–æ–±—ã —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è "–æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞" —Å –¥–ª–∏–Ω–æ–π –æ—Å–Ω–æ–≤–∞–Ω–∏—è 1 –º–µ—Ç—Ä (1000 –º–º) –∏ –≤—ã—Å–æ—Ç–æ–π —Å—Ç–æ—Ä–æ–Ω—ã 0,5 –º–µ—Ç—Ä–∞ (500 –º–º) –≤–∫–ª—é—á–∞–ª–∞ –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –≤–Ω—É—Ç—Ä–∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞. –ö–æ–¥ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å GCodeParser, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å 10 –∫–æ–º–∞–Ω–¥ (G0, G1, G2, G3, G4, G28, G90, G91, M3, M5), —É—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ G-code (–Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å ;), —á–∏—Ç–∞—Ç—å –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–∑ launch-—Ñ–∞–π–ª–∞, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏ –Ω–∞ –Ω–æ–≤—ã—Ö —Å—Ç—Ä–æ–∫–∞—Ö –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫.
–ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º?
–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è "–æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞": –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ (0,0 ‚Üí 1000,0 ‚Üí 1000,500 ‚Üí 0,500) —Å "–∫–ª–∞–ø–∞–Ω–æ–º" (–≤–µ—Ä—à–∏–Ω–∞ –≤ 500,750).
–î–∏–∞–≥–æ–Ω–∞–ª–∏: –î–æ–±–∞–≤–∏–º –¥–≤–µ –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –≤–Ω—É—Ç—Ä–∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞:
–û—Ç (0,0) –∫ (1000,500).
–û—Ç (1000,0) –∫ (0,500).
–î–∏–∞–≥–æ–Ω–∞–ª–∏ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞, —á—Ç–æ–±—ã –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å –∏—Ö –∫–∞–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã.
–û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è
–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –≤ –ø–ª–æ—Å–∫–æ—Å—Ç–∏ XY (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö):
–ù–∞—á–∞—Ç—å –≤ (0,0) ‚Äî G0 X0 Y0 (–Ω–∏–∂–Ω–∏–π –ª–µ–≤—ã–π —É–≥–æ–ª).
–î–≤–∏–≥–∞—Ç—å—Å—è –≤–ø—Ä–∞–≤–æ –≤–¥–æ–ª—å –æ—Å–Ω–æ–≤–∞–Ω–∏—è: G1 X1000 Y0 (–Ω–∏–∂–Ω–∏–π –ø—Ä–∞–≤—ã–π —É–≥–æ–ª).
–î–≤–∏–≥–∞—Ç—å—Å—è –≤–≤–µ—Ä—Ö –ø–æ –ø—Ä–∞–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ: G1 X1000 Y500 (–≤–µ—Ä—Ö–Ω–∏–π –ø—Ä–∞–≤—ã–π —É–≥–æ–ª).
–î–≤–∏–≥–∞—Ç—å—Å—è –∫ –≤–µ—Ä—à–∏–Ω–µ –∫–ª–∞–ø–∞–Ω–∞: G1 X500 Y750 (—Ü–µ–Ω—Ç—Ä –∫–ª–∞–ø–∞–Ω–∞).
–î–≤–∏–≥–∞—Ç—å—Å—è –∫ –≤–µ—Ä—Ö–Ω–µ–º—É –ª–µ–≤–æ–º—É —É–≥–ª—É: G1 X0 Y500 (–≤–µ—Ä—Ö–Ω–∏–π –ª–µ–≤—ã–π —É–≥–æ–ª).
–î–≤–∏–≥–∞—Ç—å—Å—è –≤–Ω–∏–∑ –ø–æ –ª–µ–≤–æ–π —Å—Ç–æ—Ä–æ–Ω–µ: G1 X0 Y0 (–≤–æ–∑–≤—Ä–∞—Ç –≤ –Ω–∞—á–∞–ª–æ).
–î–∏–∞–≥–æ–Ω–∞–ª—å 1: G1 X1000 Y500 (–æ—Ç (0,0) –∫ (1000,500)).
–í–µ—Ä–Ω—É—Ç—å—Å—è: G0 X0 Y0 (–±—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫–æ –≤—Ç–æ—Ä–æ–π –¥–∏–∞–≥–æ–Ω–∞–ª–∏).
–î–∏–∞–≥–æ–Ω–∞–ª—å 2: G1 X1000 Y0 (–æ—Ç (0,0) –∫ (1000,0)).
–î–≤–∏–≥–∞—Ç—å—Å—è –∫ (0,500): G1 X0 Y500 (–≤—Ç–æ—Ä–∞—è –¥–∏–∞–≥–æ–Ω–∞–ª—å, –æ—Ç (1000,0) –∫ (0,500)).
–≠—Ç–∞ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è —Ä–∏—Å—É–µ—Ç "–æ—Ç–∫—Ä—ã—Ç—ã–π –∫–æ–Ω–≤–µ—Ä—Ç" —Å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–º, –∫–ª–∞–ø–∞–Ω–æ–º –∏ –¥–≤—É–º—è –¥–∏–∞–≥–æ–Ω–∞–ª—è–º–∏ –≤–Ω—É—Ç—Ä–∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞.
–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ñ–∞–π–ª G-code (/control_code/my_custom_gcode.txt)
–§–∞–π–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥—ã. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö, —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–¥–∞—á–∏ (F) ‚Äî 100 –º–º/–º–∏–Ω.
G90 ; –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–π —Ä–µ–∂–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
M3 ; –í–∫–ª—é—á–∏—Ç—å —à–ø–∏–Ω–¥–µ–ª—å –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã
G0 X0 Y0 ; –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É (0, 0)
G1 X1000 Y0 F100 ; –õ–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–¥–æ–ª—å –æ—Å–Ω–æ–≤–∞–Ω–∏—è –∫ (1000, 0)
G1 X1000 Y500 F100 ; –õ–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–≤–µ—Ä—Ö –∫ (1000, 500)
G1 X500 Y750 F100 ; –õ–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫ –≤–µ—Ä—à–∏–Ω–µ –∫–ª–∞–ø–∞–Ω–∞ (500, 750)
G1 X0 Y500 F100 ; –õ–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫ –≤–µ—Ä—Ö–Ω–µ–º—É –ª–µ–≤–æ–º—É —É–≥–ª—É (0, 500)
G1 X0 Y0 F100 ; –õ–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–Ω–∏–∑ –∫ –Ω–∞—á–∞–ª—É (0, 0)
G1 X1000 Y500 F100 ; –õ–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–æ –ø–µ—Ä–≤–æ–π –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –∫ (1000, 500)
G0 X0 Y0 ; –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ –≤ (0, 0) –¥–ª—è –≤—Ç–æ—Ä–æ–π –¥–∏–∞–≥–æ–Ω–∞–ª–∏
G1 X1000 Y0 F100 ; –õ–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫ (1000, 0)
G1 X0 Y500 F100 ; –õ–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–æ –≤—Ç–æ—Ä–æ–π –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –∫ (0, 500)
G4 P1000 ; –ü–∞—É–∑–∞ –Ω–∞ 1000 –º—Å –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º
M5 ; –í—ã–∫–ª—é—á–∏—Ç—å —à–ø–∏–Ω–¥–µ–ª—å
G28 ; –í–æ–∑–≤—Ä–∞—Ç –≤ –¥–æ–º–∞—à–Ω—é—é –ø–æ–∑–∏—Ü–∏—é (0, 0, 0)
–û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∫–æ–¥
–ö–æ–¥ –æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ—á—Ç–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É, –Ω–æ —è –¥–æ–±–∞–≤–ª—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–π —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ (–¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏) –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π. –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (X ‚â§ 1000, Y ‚â§ 750) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è.
cpp
#include <ros/ros.h> // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ ROS
#include <std_msgs/String.h> // –î–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
#include <fstream> // –î–ª—è —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞
#include <sstream> // –î–ª—è —Ä–∞–∑–±–æ—Ä–∞ —Å—Ç—Ä–æ–∫
#include <vector> // –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
#include <string> // –î–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏
#include <algorithm> // –î–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç—Ä–æ–∫ (trim)
#include <cmath> // –î–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã G-code
struct GCodeCommand
{
    std::string command; // –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã (G0, G1, M3 –∏ —Ç.–¥.)
    float x, y, z; // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã X, Y, Z
    float i, j; // –¶–µ–Ω—Ç—Ä –¥—É–≥–∏ –¥–ª—è G2/G3
    float f; // –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–¥–∞—á–∏
    float p; // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—É–∑—ã –¥–ª—è G4
    bool has_x, has_y, has_z, has_i, has_j, has_f, has_p; // –§–ª–∞–≥–∏ –Ω–∞–ª–∏—á–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    std::string comment; // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∫–æ–º–∞–Ω–¥–µ
};

// –ö–ª–∞—Å—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ G-code
class GCodeParser
{
private:
    ros::NodeHandle nh_; // NodeHandle –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å ROS
    ros::Publisher pub_; // –ü–∞–±–ª–∏—à–µ—Ä –¥–ª—è —Ç–æ–ø–∏–∫–∞ robot_position
    std::vector<GCodeCommand> commands_; // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
    bool absolute_mode_; // –†–µ–∂–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: true ‚Äî –∞–±—Å–æ–ª—é—Ç–Ω—ã–π, false ‚Äî –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π
    float current_x_, current_y_, current_z_; // –¢–µ–∫—É—â–∞—è –ø–æ–∑–∏—Ü–∏—è —Ä–æ–±–æ—Ç–∞
    std::string gcode_file_; // –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É G-code
    const float MAX_X_ = 1000.0; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X
    const float MAX_Y_ = 750.0; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y

    // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫–∏
    std::string trim(const std::string& str)
    {
        size_t first = str.find_first_not_of(" \t"); // –ü–æ–∏—Å–∫ –ø–µ—Ä–≤–æ–≥–æ –Ω–µ–ø—Ä–æ–±–µ–ª—å–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
        size_t last = str.find_last_not_of(" \t"); // –ü–æ–∏—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –Ω–µ–ø—Ä–æ–±–µ–ª—å–Ω–æ–≥–æ —Å–∏–º–≤–æ–ª–∞
        if (first == std::string::npos) return ""; // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –ø—É—Å—Ç–∞, –≤–µ—Ä–Ω—É—Ç—å –ø—É—Å—Ç—É—é
        return str.substr(first, last - first + 1); // –í—ã—Ä–µ–∑–∞—Ç—å –ø–æ–¥—Å—Ç—Ä–æ–∫—É
    }

    // –†–∞–∑–±–æ—Ä —Å—Ç—Ä–æ–∫–∏ G-code
    bool parseGCodeLine(const std::string& line, GCodeCommand& cmd)
    {
        std::string code_part = line; // –ß–∞—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ —Å –∫–æ–¥–æ–º
        cmd = GCodeCommand(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        cmd.has_x = cmd.has_y = cmd.has_z = cmd.has_i = cmd.has_j = cmd.has_f = cmd.has_p = false; // –°–±—Ä–æ—Å —Ñ–ª–∞–≥–æ–≤

        // –ü–æ–∏—Å–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å ';')
        size_t comment_pos = line.find(';'); // –ü–æ–∑–∏—Ü–∏—è –Ω–∞—á–∞–ª–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        if (comment_pos != std::string::npos)
        {
            cmd.comment = trim(line.substr(comment_pos + 1)); // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
            code_part = trim(line.substr(0, comment_pos)); // –ö–æ–¥ –¥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        }
        else
        {
            cmd.comment = ""; // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
            code_part = trim(line); // –ö–æ–¥ ‚Äî –≤—Å—è —Å—Ç—Ä–æ–∫–∞
        }

        if (code_part.empty()) return false; // –ü—Ä–æ–ø—É—Å–∫ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫

        std::stringstream ss(code_part); // –ü–æ—Ç–æ–∫ –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞ –∫–æ–¥–∞
        std::string token; // –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
        ss >> token; // –ß—Ç–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã (G0, G1 –∏ —Ç.–¥.)
        if (token.empty() || (token[0] != 'G' && token[0] != 'M')) return false; // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏
        cmd.command = token; // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã

        while (ss >> token)
        {
            char param = token[0]; // –¢–∏–ø –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ (X, Y, Z –∏ —Ç.–¥.)
            try
            {
                float value = std::stof(token.substr(1)); // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —á–∏—Å–ª–æ
                if (param == 'X')
                {
                    if (value < 0 || value > MAX_X_) throw std::invalid_argument("–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞"); // –ü—Ä–æ–≤–µ—Ä–∫–∞
                    cmd.x = value; cmd.has_x = true; // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ X
                }
                else if (param == 'Y')
                {
                    if (value < 0 || value > MAX_Y_) throw std::invalid_argument("–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞"); // –ü—Ä–æ–≤–µ—Ä–∫–∞
                    cmd.y = value; cmd.has_y = true; // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Y
                }
                else if (param == 'Z')
                {
                    if (value < 0) throw std::invalid_argument("–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Z"); // –ü—Ä–æ–≤–µ—Ä–∫–∞
                    cmd.z = value; cmd.has_z = true; // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Z
                }
                else if (param == 'I')
                {
                    cmd.i = value; cmd.has_i = true; // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ I
                }
                else if (param == 'J')
                {
                    cmd.j = value; cmd.has_j = true; // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ J
                }
                else if (param == 'F')
                {
                    if (value <= 0) throw std::invalid_argument("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å F"); // –ü—Ä–æ–≤–µ—Ä–∫–∞
                    cmd.f = value; cmd.has_f = true; // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ F
                }
                else if (param == 'P')
                {
                    if (value < 0) throw std::invalid_argument("–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –ø–∞—É–∑–∞ P"); // –ü—Ä–æ–≤–µ—Ä–∫–∞
                    cmd.p = value; cmd.has_p = true; // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ P
                }
            }
            catch (const std::exception& e)
            {
                ROS_WARN("–û—à–∏–±–∫–∞ —Ä–∞–∑–±–æ—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤ —Å—Ç—Ä–æ–∫–µ: %s (%s)", line.c_str(), e.what()); // –õ–æ–≥ –æ—à–∏–±–∫–∏
                return false; // –í–æ–∑–≤—Ä–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
            }
        }
        return true; // –£—Å–ø–µ—à–Ω—ã–π —Ä–∞–∑–±–æ—Ä
    }

    // –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–æ–ø–∏–∫
    void publishMessage(const std::string& message)
    {
        std_msgs::String msg; // –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        msg.data = message; // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        pub_.publish(msg); // –ü—É–±–ª–∏–∫–∞—Ü–∏—è
    }

    // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –º–µ–∂–¥—É —Ç–µ–∫—É—â–µ–π –∏ –Ω–æ–≤–æ–π –ø–æ–∑–∏—Ü–∏–µ–π
    float calculateDistance(float new_x, float new_y, float new_z)
    {
        float dx = new_x - current_x_; // –†–∞–∑–Ω–∏—Ü–∞ –ø–æ X
        float dy = new_y - current_y_; // –†–∞–∑–Ω–∏—Ü–∞ –ø–æ Y
        float dz = new_z - current_z_; // –†–∞–∑–Ω–∏—Ü–∞ –ø–æ Z
        return std::sqrt(dx * dx + dy * dy + dz * dz); // –ï–≤–∫–ª–∏–¥–æ–≤–∞ –¥–∏—Å—Ç–∞–Ω—Ü–∏—è
    }

    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G0 (–±—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ)
    void executeG0(const GCodeCommand& cmd)
    {
        std::stringstream ss; // –î–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∞
        float new_x = cmd.has_x ? cmd.x : current_x_; // –ù–æ–≤–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X
        float new_y = cmd.has_y ? cmd.y : current_y_; // –ù–æ–≤–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y
        float new_z = cmd.has_z ? cmd.z : current_z_; // –ù–æ–≤–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Z
        if (absolute_mode_)
        {
            current_x_ = new_x; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ X
            current_y_ = new_y; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Y
            current_z_ = new_z; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Z
        }
        else
        {
            current_x_ += cmd.has_x ? cmd.x : 0.0; // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ X
            current_y_ += cmd.has_y ? cmd.y : 0.0; // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ Y
            current_z_ += cmd.has_z ? cmd.z : 0.0; // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ Z
        }
        ss << "G0: –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫ X=" << current_x_ << " Y=" << current_y_ << " Z=" << current_z_;
        if (!cmd.comment.empty()) ss << " (" << cmd.comment << ")"; // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        ROS_INFO("%s", ss.str().c_str()); // –í—ã–≤–æ–¥ –ª–æ–≥–∞
        publishMessage(ss.str()); // –ü—É–±–ª–∏–∫–∞—Ü–∏—è
    }

    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G1 (–ª–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ)
    void executeG1(const GCodeCommand& cmd)
    {
        std::stringstream ss; // –î–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∞
        float feed_rate = cmd.has_f ? cmd.f : 100.0; // –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–¥–∞—á–∏, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100
        float new_x = cmd.has_x ? cmd.x : current_x_; // –ù–æ–≤–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X
        float new_y = cmd.has_y ? cmd.y : current_y_; // –ù–æ–≤–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y
        float new_z = cmd.has_z ? cmd.z : current_z_; // –ù–æ–≤–∞—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Z
        if (absolute_mode_)
        {
            current_x_ = new_x; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ X
            current_y_ = new_y; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Y
            current_z_ = new_z; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Z
        }
        else
        {
            current_x_ += cmd.has_x ? cmd.x : 0.0; // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ X
            current_y_ += cmd.has_y ? cmd.y : 0.0; // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ Y
            current_z_ += cmd.has_z ? cmd.z : 0.0; // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ Z
        }
        float distance = calculateDistance(new_x, new_y, new_z); // –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏
        ss << "G1: –õ–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫ X=" << current_x_ << " Y=" << current_y_ << " Z=" << current_z_ << " F=" << feed_rate;
        ss << ", –¥–∏—Å—Ç–∞–Ω—Ü–∏—è=" << distance << " –º–º";
        if (!cmd.comment.empty()) ss << " (" << cmd.comment << ")"; // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        ROS_INFO("%s", ss.str().c_str()); // –í—ã–≤–æ–¥ –ª–æ–≥–∞
        publishMessage(ss.str()); // –ü—É–±–ª–∏–∫–∞—Ü–∏—è
    }

    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G2 (–¥—É–≥–∞ –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ)
    void executeG2(const GCodeCommand& cmd)
    {
        std::stringstream ss; // –î–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∞
        float center_i = cmd.has_i ? cmd.i : 0.0; // –°–º–µ—â–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ –ø–æ X
        float center_j = cmd.has_j ? cmd.j : 0.0; // –°–º–µ—â–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ –ø–æ Y
        float feed_rate = cmd.has_f ? cmd.f : 100.0; // –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–¥–∞—á–∏
        if (absolute_mode_)
        {
            current_x_ = cmd.has_x ? cmd.x : current_x_; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ X
            current_y_ = cmd.has_y ? cmd.y : current_y_; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Y
        }
        else
        {
            current_x_ += cmd.has_x ? cmd.x : 0.0; // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ X
            current_y_ += cmd.has_y ? cmd.y : 0.0; // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ Y
        }
        ss << "G2: –î—É–≥–∞ –ø–æ —á–∞—Å–æ–≤–æ–π –∫ X=" << current_x_ << " Y=" << current_y_ << " I=" << center_i << " J=" << center_j << " F=" << feed_rate;
        if (!cmd.comment.empty()) ss << " (" << cmd.comment << ")"; // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        ROS_INFO("%s", ss.str().c_str()); // –í—ã–≤–æ–¥ –ª–æ–≥–∞
        publishMessage(ss.str()); // –ü—É–±–ª–∏–∫–∞—Ü–∏—è
    }

    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G3 (–¥—É–≥–∞ –ø—Ä–æ—Ç–∏–≤ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–∏)
    void executeG3(const GCodeCommand& cmd)
    {
        std::stringstream ss; // –î–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∞
        float center_i = cmd.has_i ? cmd.i : 0.0; // –°–º–µ—â–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ –ø–æ X
        float center_j = cmd.has_j ? cmd.j : 0.0; // –°–º–µ—â–µ–Ω–∏–µ —Ü–µ–Ω—Ç—Ä–∞ –ø–æ Y
        float feed_rate = cmd.has_f ? cmd.f : 100.0; // –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–¥–∞—á–∏
        if (absolute_mode_)
        {
            current_x_ = cmd.has_x ? cmd.x : current_x_; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ X
            current_y_ = cmd.has_y ? cmd.y : current_y_; // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Y
        }
        else
        {
            current_x_ += cmd.has_x ? cmd.x : 0.0; // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ X
            current_y_ += cmd.has_y ? cmd.y : 0.0; // –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ Y
        }
        ss << "G3: –î—É–≥–∞ –ø—Ä–æ—Ç–∏–≤ —á–∞—Å–æ–≤–æ–π –∫ X=" << current_x_ << " Y=" << current_y_ << " I=" << center_i << " J=" << center_j << " F=" << feed_rate;
        if (!cmd.comment.empty()) ss << " (" << cmd.comment << ")"; // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        ROS_INFO("%s", ss.str().c_str()); // –í—ã–≤–æ–¥ –ª–æ–≥–∞
        publishMessage(ss.str()); // –ü—É–±–ª–∏–∫–∞—Ü–∏—è
    }

    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G4 (–ø–∞—É–∑–∞)
    void executeG4(const GCodeCommand& cmd)
    {
        std::stringstream ss; // –î–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∞
        float pause_ms = cmd.has_p ? cmd.p : 0.0; // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—É–∑—ã –≤ –º—Å
        ss << "G4: –ü–∞—É–∑–∞ –Ω–∞ " << pause_ms << " –º—Å";
        if (!cmd.comment.empty()) ss << " (" << cmd.comment << ")"; // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        ROS_INFO("%s", ss.str().c_str()); // –í—ã–≤–æ–¥ –ª–æ–≥–∞
        ros::Duration(pause_ms / 1000.0).sleep(); // –û–∂–∏–¥–∞–Ω–∏–µ
        publishMessage(ss.str()); // –ü—É–±–ª–∏–∫–∞—Ü–∏—è
    }

    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G28 (–≤–æ–∑–≤—Ä–∞—Ç –¥–æ–º–æ–π)
    void executeG28(const GCodeCommand& cmd)
    {
        std::stringstream ss; // –î–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∞
        current_x_ = 0.0; // –°–±—Ä–æ—Å X
        current_y_ = 0.0; // –°–±—Ä–æ—Å Y
        current_z_ = 0.0; // –°–±—Ä–æ—Å Z
        ss << "G28: –í–æ–∑–≤—Ä–∞—Ç –≤ –¥–æ–º–∞—à–Ω—é—é –ø–æ–∑–∏—Ü–∏—é (0, 0, 0)";
        if (!cmd.comment.empty()) ss << " (" << cmd.comment << ")"; // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        ROS_INFO("%s", ss.str().c_str()); // –í—ã–≤–æ–¥ –ª–æ–≥–∞
        publishMessage(ss.str()); // –ü—É–±–ª–∏–∫–∞—Ü–∏—è
    }

    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G90 (–∞–±—Å–æ–ª—é—Ç–Ω—ã–π —Ä–µ–∂–∏–º)
    void executeG90(const GCodeCommand& cmd)
    {
        std::stringstream ss; // –î–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∞
        absolute_mode_ = true; // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
        ss << "G90: –ê–±—Å–æ–ª—é—Ç–Ω—ã–π —Ä–µ–∂–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç";
        if (!cmd.comment.empty()) ss << " (" << cmd.comment << ")"; // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        ROS_INFO("%s", ss.str().c_str()); // –í—ã–≤–æ–¥ –ª–æ–≥–∞
        publishMessage(ss.str()); // –ü—É–±–ª–∏–∫–∞—Ü–∏—è
    }

    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G91 (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º)
    void executeG91(const GCodeCommand& cmd)
    {
        std::stringstream ss; // –î–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∞
        absolute_mode_ = false; // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
        ss << "G91: –û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç";
        if (!cmd.comment.empty()) ss << " (" << cmd.comment << ")"; // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        ROS_INFO("%s", ss.str().c_str()); // –í—ã–≤–æ–¥ –ª–æ–≥–∞
        publishMessage(ss.str()); // –ü—É–±–ª–∏–∫–∞—Ü–∏—è
    }

    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ M3 (–≤–∫–ª—é—á–µ–Ω–∏–µ —à–ø–∏–Ω–¥–µ–ª—è)
    void executeM3(const GCodeCommand& cmd)
    {
        std::stringstream ss; // –î–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∞
        ss << "M3: –®–ø–∏–Ω–¥–µ–ª—å –≤–∫–ª—é—á–µ–Ω";
        if (!cmd.comment.empty()) ss << " (" << cmd.comment << ")"; // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        ROS_INFO("%s", ss.str().c_str()); // –í—ã–≤–æ–¥ –ª–æ–≥–∞
        publishMessage(ss.str()); // –ü—É–±–ª–∏–∫–∞—Ü–∏—è
    }

    // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ M5 (–≤—ã–∫–ª—é—á–µ–Ω–∏–µ —à–ø–∏–Ω–¥–µ–ª—è)
    void executeM5(const GCodeCommand& cmd)
    {
        std::stringstream ss; // –î–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ª–æ–≥–∞
        ss << "M5: –®–ø–∏–Ω–¥–µ–ª—å –≤—ã–∫–ª—é—á–µ–Ω";
        if (!cmd.comment.empty()) ss << " (" << cmd.comment << ")"; // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        ROS_INFO("%s", ss.str().c_str()); // –í—ã–≤–æ–¥ –ª–æ–≥–∞
        publishMessage(ss.str()); // –ü—É–±–ª–∏–∫–∞—Ü–∏—è
    }

public:
    // –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
    GCodeParser() : nh_(), pub_(nh_.advertise<std_msgs::String>("robot_position", 10)),
                    absolute_mode_(true), current_x_(0.0), current_y_(0.0), current_z_(0.0),
                    gcode_file_("/control_code/my_custom_gcode.txt")
    {
        nh_.param<std::string>("gcode_file", gcode_file_, gcode_file_); // –ß—Ç–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ gcode_file
        ROS_INFO("–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–π–ª G-code: %s", gcode_file_.c_str()); // –í—ã–≤–æ–¥ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É
    }

    // –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    void run()
    {
        std::ifstream file(gcode_file_.c_str()); // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞
        if (!file.is_open())
        {
            ROS_ERROR("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª: %s", gcode_file_.c_str()); // –í—ã–≤–æ–¥ –æ—à–∏–±–∫–∏
            return; // –í—ã—Ö–æ–¥
        }

        std::string line; // –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
        while (std::getline(file, line))
        {
            line = trim(line); // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤
            if (line.empty() || line[0] == '%') continue; // –ü—Ä–æ–ø—É—Å–∫ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–æ–∫ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
            GCodeCommand cmd; // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–æ–º–∞–Ω–¥—ã
            if (parseGCodeLine(line, cmd))
            {
                commands_.push_back(cmd); // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
                std::string log = "–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞: " + line;
                if (!cmd.comment.empty()) log += " (" + cmd.comment + ")"; // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
                ROS_INFO("%s", log.c_str()); // –í—ã–≤–æ–¥ –ª–æ–≥–∞
            }
            else
            {
                ROS_WARN("–ù–µ–≤–∞–ª–∏–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞: %s", line.c_str()); // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
            }
        }
        file.close(); // –ó–∞–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–∞

        ros::Rate loop_rate(1); // –ß–∞—Å—Ç–æ—Ç–∞ 1 –ì—Ü
        for (const auto& cmd : commands_)
        {
            if (cmd.command == "G0") executeG0(cmd); // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G0
            else if (cmd.command == "G1") executeG1(cmd); // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G1
            else if (cmd.command == "G2") executeG2(cmd); // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G2
            else if (cmd.command == "G3") executeG3(cmd); // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G3
            else if (cmd.command == "G4") executeG4(cmd); // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G4
            else if (cmd.command == "G28") executeG28(cmd); // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G28
            else if (cmd.command == "G90") executeG90(cmd); // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G90
            else if (cmd.command == "G91") executeG91(cmd); // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ G91
            else if (cmd.command == "M3") executeM3(cmd); // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ M3
            else if (cmd.command == "M5") executeM5(cmd); // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ M5
            else ROS_WARN("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: %s (%s)", cmd.command.c_str(), cmd.comment.c_str()); // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
            ros::spinOnce(); // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
            loop_rate.sleep(); // –ü–∞—É–∑–∞
        }

        ROS_INFO("–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã"); // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏
    }
};

int main(int argc, char **argv)
{
    ros::init(argc, argv, "gcode_parser_node"); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ROS
    GCodeParser parser; // –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –ø–∞—Ä—Å–µ—Ä–∞
    parser.run(); // –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    return 0; // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ
}
Launch-—Ñ–∞–π–ª (launch/gcode_parser.launch)
xml
<launch>
    <!-- –ó–∞–ø—É—Å–∫ –Ω–æ–¥—ã gcode_parser_node -->
    <node name="gcode_parser_node" pkg="gcode_parser" type="gcode_parser_node" output="screen">
        <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É G-code -->
        <param name="gcode_file" value="/control_code/my_custom_gcode.txt" />
    </node>
</launch>
–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ–¥:
G-code —Ñ–∞–π–ª:
–û–ø–∏—Å—ã–≤–∞–µ—Ç —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—é "–æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∫–æ–Ω–≤–µ—Ä—Ç–∞" —Å –æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º 1000 –º–º, –≤—ã—Å–æ—Ç–æ–π 500 –º–º –∏ –∫–ª–∞–ø–∞–Ω–æ–º (–≤–µ—Ä—à–∏–Ω–∞ –≤ (500, 750)).
–î–æ–±–∞–≤–ª–µ–Ω—ã –¥–≤–µ –¥–∏–∞–≥–æ–Ω–∞–ª–∏: (0,0) ‚Üí (1000,500) –∏ (1000,0) ‚Üí (0,500).
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (G90), –ª–∏–Ω–µ–π–Ω—ã–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è (G1), –∏ –≤–∫–ª—é—á–∞–µ—Ç —à–ø–∏–Ω–¥–µ–ª—å (M3/M5).
–ö–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—Ç—Å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º —Å ;.
–ö–æ–¥:
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (X ‚â§ 1000, Y ‚â§ 750, Z ‚â• 0, F > 0, P ‚â• 0).
–õ–æ–≥–∏—Ä—É–µ—Ç –¥–∏—Å—Ç–∞–Ω—Ü–∏—é –¥–ª—è G1-–∫–æ–º–∞–Ω–¥, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–¥–∏—Ç—å –¥–ª–∏–Ω—É –ª–∏–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –∏–º–µ—é—Ç –¥–ª–∏–Ω—É ‚àö(1000¬≤ + 500¬≤) ‚âà 1118 –º–º).
–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–ø–æ—Å–ª–µ ;) –∏ –≤–∫–ª—é—á–∞–µ—Ç –∏—Ö –≤ –ª–æ–≥–∏.
–ü—É–±–ª–∏–∫—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Ç–æ–ø–∏–∫ /robot_position.
–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è:
–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤ (0,0), –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ (1000,0), (1000,500), (500,750), (0,500), (0,0).
–î–æ–±–∞–≤–ª—è–µ—Ç –¥–∏–∞–≥–æ–Ω–∞–ª–∏: (0,0) ‚Üí (1000,500) –∏ (1000,0) ‚Üí (0,500).
–ó–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –≤–æ–∑–≤—Ä–∞—Ç–æ–º –≤ (0,0,0) —á–µ—Ä–µ–∑ G28.
–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å:
–°–æ–∑–¥–∞–π ROS-–ø–∞–∫–µ—Ç:
bash
catkin_create_pkg gcode_parser roscpp std_msgs
–°–æ—Ö—Ä–∞–Ω–∏ –∫–æ–¥ –≤ src/gcode_parser_node.cpp.
–û–±–Ω–æ–≤–∏ CMakeLists.txt:
cmake
add_executable(gcode_parser_node src/gcode_parser_node.cpp)
target_link_libraries(gcode_parser_node ${catkin_LIBRARIES})
–£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤ package.xml –µ—Å—Ç—å:
xml
<depend>roscpp</depend>
<depend>std_msgs</depend>
–°–æ–∑–¥–∞–π –ø–∞–ø–∫—É launch –∏ —Å–æ—Ö—Ä–∞–Ω–∏ launch-—Ñ–∞–π–ª:
bash
mkdir -p gcode_parser/launch
nano gcode_parser/launch/gcode_parser.launch
–°–æ–∑–¥–∞–π G-code —Ñ–∞–π–ª:
bash
mkdir -p /control_code
nano /control_code/my_custom_gcode.txt
–°–æ–±–µ—Ä–∏ –∏ –∑–∞–ø—É—Å—Ç–∏:
bash
catkin_make
source devel/setup.bash
roslaunch gcode_parser gcode_parser.launch
–°–ª–µ–¥–∏ –∑–∞ –ª–æ–≥–∞–º–∏:
bash
rostopic echo /robot_position
–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ –ª–æ–≥–æ–≤:
[INFO] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∞–π–ª G-code: /control_code/my_custom_gcode.txt
[INFO] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞: G90 (–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–π —Ä–µ–∂–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)
[INFO] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞: M3 (–í–∫–ª—é—á–∏—Ç—å —à–ø–∏–Ω–¥–µ–ª—å –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã)
[INFO] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞: G0 X0 Y0 (–ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É (0, 0))
...
[INFO] G90: –ê–±—Å–æ–ª—é—Ç–Ω—ã–π —Ä–µ–∂–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç (–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω—ã–π —Ä–µ–∂–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)
[INFO] M3: –®–ø–∏–Ω–¥–µ–ª—å –≤–∫–ª—é—á–µ–Ω (–í–∫–ª—é—á–∏—Ç—å —à–ø–∏–Ω–¥–µ–ª—å –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã)
[INFO] G0: –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫ X=0 Y=0 Z=0 (–ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–æ—á–∫—É (0, 0))
[INFO] G1: –õ–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫ X=1000 Y=0 Z=0 F=100, –¥–∏—Å—Ç–∞–Ω—Ü–∏—è=1000 –º–º (–õ–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–¥–æ–ª—å –æ—Å–Ω–æ–≤–∞–Ω–∏—è –∫ (1000, 0))
...
[INFO] G1: –õ–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –∫ X=1000 Y=500 Z=0 F=100, –¥–∏—Å—Ç–∞–Ω—Ü–∏—è=1118.03 –º–º (–õ–∏–Ω–µ–π–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–æ –ø–µ—Ä–≤–æ–π –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –∫ (1000, 500))
...
[INFO] –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
–î–∏–∞–≥–æ–Ω–∞–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–∞–∫ –ª–∏–Ω–∏–∏ –≤–Ω—É—Ç—Ä–∏ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏—Ö –ø–æ—Ä—è–¥–æ–∫ –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –ª–∏–Ω–∏–∏, —É—Ç–æ—á–Ω–∏.
–î–ª–∏–Ω–∞ –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π (‚âà1118 –º–º) –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ calculateDistance, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç ‚àö(1000¬≤ + 500¬≤).
–ö–æ–¥ –æ—Å—Ç–∞—ë—Ç—Å—è –∑–∞–≥–ª—É—à–∫–æ–π. –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–æ–±–æ—Ç–∞ –¥–æ–±–∞–≤—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ executeG* –∏ executeM*.
–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ RViz), —è –º–æ–≥—É –¥–æ–±–∞–≤–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é –≤ —Ç–æ–ø–∏–∫ —Å –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
–ï—Å–ª–∏ –Ω—É–∂–Ω—ã –¥–æ—Ä–∞–±–æ—Ç–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥—Ä—É–≥–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–∏–∞–≥–æ–Ω–∞–ª–µ–π, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏), –¥–∞–π –∑–Ω–∞—Ç—å! üòä